.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_dataset_plot_dataset_xarray.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_dataset_plot_dataset_xarray.py:


Define an electrophysiological dataset using Xarray
===================================================

This example illustrates how to define a dataset using Xarray. If you don't
know this library, we can simplify by saying that it provides containers that
accept arrays but you can also labelize your dimensions. Another way of seeing
it, pandas is mostly made for tables (i.e 2D arrays) while Xarray provide
almost the same functionalities but for multi-dimensional arrays.



.. code-block:: default

    import numpy as np
    import pandas as pd

    from xarray import DataArray
    from frites.dataset import DatasetEphy

    import matplotlib.pyplot as plt







Create artificial data
----------------------

We start by creating some random data for several subjects. To do that, each
subject is going have a 3 dimensional array of shape
(n_epochs, n_channels, n_times). Then, all of the arrays are grouped together
in a list of length (n_subjects,)


.. code-block:: default


    n_subjects = 5
    n_epochs = 10
    n_channels = 5
    n_times = 100
    sf = 512

    x, ch = [], []
    for k in range(n_subjects):
        # generate single subject data
        x_suj = np.random.rand(n_epochs, n_channels, n_times)
        # generate some random channel names
        ch_suj = np.array([f"ch_{r}" for r in range(n_channels)])
        # concatenate in a list
        x.append(x_suj)
        ch.append(ch_suj)
    # finally lets create a time vector
    times = np.arange(n_times) / sf
    epochs = np.arange(n_epochs)







Xarray conversion to DataArray
------------------------------

Here, we convert the NumPy arrays to xarray.DataArray


.. code-block:: default


    x_xr = []
    for k in range(n_subjects):
        # DataArray conversion
        arr_xr = DataArray(x[k], dims=('epochs', 'channels', 'times'),
                           coords=(epochs, ch[k], times))
        # finally, replace it in the original list
        x_xr.append(arr_xr)
    print(x_xr[0])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    <xarray.DataArray (epochs: 10, channels: 5, times: 100)>
    array([[[0.29243871, 0.27626268, 0.76480278, ..., 0.33999536,
             0.70515586, 0.34141924],
            [0.3614542 , 0.31079268, 0.21929757, ..., 0.48532326,
             0.35789053, 0.03764082],
            [0.55150385, 0.46771976, 0.35097665, ..., 0.96137293,
             0.93013841, 0.99491471],
            [0.66071792, 0.14959146, 0.09382064, ..., 0.32704079,
             0.01335405, 0.49783328],
            [0.37313574, 0.19936493, 0.62714266, ..., 0.75330815,
             0.83050607, 0.89105896]],

           [[0.2131212 , 0.52088952, 0.61735805, ..., 0.05452984,
             0.83418445, 0.79540701],
            [0.28497444, 0.69706186, 0.03502939, ..., 0.36488509,
             0.05182247, 0.51741245],
            [0.23011934, 0.73313986, 0.32998724, ..., 0.8591698 ,
             0.23922117, 0.27473382],
            [0.17184548, 0.57318438, 0.9704201 , ..., 0.34952768,
             0.79038738, 0.74527427],
            [0.82482427, 0.41860177, 0.03182795, ..., 0.36198512,
             0.88982771, 0.80447217]],

           [[0.05074735, 0.24598085, 0.04744361, ..., 0.80294311,
             0.96647394, 0.85619164],
            [0.28456353, 0.47327226, 0.42893725, ..., 0.77575675,
             0.89348672, 0.092912  ],
            [0.13305163, 0.25584761, 0.33263241, ..., 0.04199925,
             0.58177805, 0.91114207],
            [0.09733777, 0.62870643, 0.36516336, ..., 0.76651482,
             0.93221001, 0.61671993],
            [0.70019899, 0.62076154, 0.83452246, ..., 0.1590405 ,
             0.10872037, 0.13184683]],

           ...,

           [[0.68119131, 0.70611556, 0.61505433, ..., 0.00625921,
             0.98375512, 0.99579594],
            [0.33047823, 0.61597769, 0.60912754, ..., 0.6115006 ,
             0.24288888, 0.63442191],
            [0.84127098, 0.32435406, 0.99521945, ..., 0.7427991 ,
             0.73597168, 0.36905316],
            [0.42356732, 0.59125756, 0.01766434, ..., 0.37699756,
             0.59866   , 0.81067259],
            [0.52233852, 0.99117263, 0.55755748, ..., 0.72073451,
             0.89713102, 0.87811069]],

           [[0.2898985 , 0.9866764 , 0.78767063, ..., 0.89041725,
             0.77742503, 0.96785833],
            [0.06624122, 0.69816162, 0.86054463, ..., 0.27168905,
             0.97001576, 0.76492886],
            [0.35354373, 0.6456928 , 0.31619671, ..., 0.8668176 ,
             0.50567786, 0.44217263],
            [0.07517909, 0.62285918, 0.5459408 , ..., 0.25945596,
             0.88213915, 0.31372372],
            [0.31609663, 0.66996938, 0.32992921, ..., 0.87817784,
             0.96468947, 0.23025046]],

           [[0.74410472, 0.93083177, 0.97429923, ..., 0.62150862,
             0.12208775, 0.12296714],
            [0.02005371, 0.57656288, 0.7102006 , ..., 0.11806982,
             0.70998149, 0.23672646],
            [0.99792816, 0.41025132, 0.66050125, ..., 0.06053665,
             0.58107898, 0.30374343],
            [0.9701459 , 0.69195133, 0.99861205, ..., 0.8658693 ,
             0.3898547 , 0.07674581],
            [0.53668254, 0.36373075, 0.61964071, ..., 0.74081211,
             0.86868786, 0.73018767]]])
    Coordinates:
      * epochs    (epochs) int64 0 1 2 3 4 5 6 7 8 9
      * channels  (channels) <U4 'ch_0' 'ch_1' 'ch_2' 'ch_3' 'ch_4'
      * times     (times) float64 0.0 0.001953 0.003906 ... 0.1895 0.1914 0.1934



Build the dataset
-----------------

Finally, we pass the data to the :class:`frites.dataset.DatasetEphy` class
in order to create the dataset


.. code-block:: default


    # here, we specify to the DatasetEphy class that the roi dimension is actually
    # called 'channels' in the DataArray and the times dimension is called 'times'
    dt = DatasetEphy(x_xr, roi='channels', times='times')
    print(dt)

    print('Time vector : ', dt.times)
    print('ROI (first subject) : ', dt.roi[0])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    -------------------------------------------------------------------------------
    number of (subjects, roi, time points) : (5, 5, 100)
    minimum number of subject per roi: -inf
    modality : electrophysiological
    data grouped by : subject
    copnormed : False
    version : 0.3.3
    -------------------------------------------------------------------------------
    Time vector :  [0.         0.00195312 0.00390625 0.00585938 0.0078125  0.00976562
     0.01171875 0.01367188 0.015625   0.01757812 0.01953125 0.02148438
     0.0234375  0.02539062 0.02734375 0.02929688 0.03125    0.03320312
     0.03515625 0.03710938 0.0390625  0.04101562 0.04296875 0.04492188
     0.046875   0.04882812 0.05078125 0.05273438 0.0546875  0.05664062
     0.05859375 0.06054688 0.0625     0.06445312 0.06640625 0.06835938
     0.0703125  0.07226562 0.07421875 0.07617188 0.078125   0.08007812
     0.08203125 0.08398438 0.0859375  0.08789062 0.08984375 0.09179688
     0.09375    0.09570312 0.09765625 0.09960938 0.1015625  0.10351562
     0.10546875 0.10742188 0.109375   0.11132812 0.11328125 0.11523438
     0.1171875  0.11914062 0.12109375 0.12304688 0.125      0.12695312
     0.12890625 0.13085938 0.1328125  0.13476562 0.13671875 0.13867188
     0.140625   0.14257812 0.14453125 0.14648438 0.1484375  0.15039062
     0.15234375 0.15429688 0.15625    0.15820312 0.16015625 0.16210938
     0.1640625  0.16601562 0.16796875 0.16992188 0.171875   0.17382812
     0.17578125 0.17773438 0.1796875  0.18164062 0.18359375 0.18554688
     0.1875     0.18945312 0.19140625 0.19335938]
    ROI (first subject) :  ['ch_0' 'ch_1' 'ch_2' 'ch_3' 'ch_4']



MultiIndex support
------------------

DataArray also supports multi-indexing of a single dimension.


.. code-block:: default


    # create a continuous regressor (prediction error, delta P etc.)
    dp = np.random.uniform(-1, 1, (n_epochs,))
    # create a discret variable (e.g experimental conditions)
    cond = np.array([0] * 5 + [1] * 5)

    # now, create a multi-index using pandas
    midx = pd.MultiIndex.from_arrays((dp, cond), names=('dp', 'blocks'))

    # convert again the original arrays but this time, the epoch dimension is going
    # to be a multi-index
    x_xr = []
    for k in range(n_subjects):
        # DataArray conversion
        arr_xr = DataArray(x[k], dims=('epochs', 'channels', 'times'),
                           coords=(midx, ch[k], times))
        # finally, replace it in the original list
        x_xr.append(arr_xr)
    print(x_xr[0])

    # finally, when you create your dataset you can also specify the y and z inputs
    # by providing their names in the DataArray
    dt = DatasetEphy(x_xr, roi='channels', times='times', y='dp', z='blocks')
    print(dt)




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    <xarray.DataArray (epochs: 10, channels: 5, times: 100)>
    array([[[0.29243871, 0.27626268, 0.76480278, ..., 0.33999536,
             0.70515586, 0.34141924],
            [0.3614542 , 0.31079268, 0.21929757, ..., 0.48532326,
             0.35789053, 0.03764082],
            [0.55150385, 0.46771976, 0.35097665, ..., 0.96137293,
             0.93013841, 0.99491471],
            [0.66071792, 0.14959146, 0.09382064, ..., 0.32704079,
             0.01335405, 0.49783328],
            [0.37313574, 0.19936493, 0.62714266, ..., 0.75330815,
             0.83050607, 0.89105896]],

           [[0.2131212 , 0.52088952, 0.61735805, ..., 0.05452984,
             0.83418445, 0.79540701],
            [0.28497444, 0.69706186, 0.03502939, ..., 0.36488509,
             0.05182247, 0.51741245],
            [0.23011934, 0.73313986, 0.32998724, ..., 0.8591698 ,
             0.23922117, 0.27473382],
            [0.17184548, 0.57318438, 0.9704201 , ..., 0.34952768,
             0.79038738, 0.74527427],
            [0.82482427, 0.41860177, 0.03182795, ..., 0.36198512,
             0.88982771, 0.80447217]],

           [[0.05074735, 0.24598085, 0.04744361, ..., 0.80294311,
             0.96647394, 0.85619164],
            [0.28456353, 0.47327226, 0.42893725, ..., 0.77575675,
             0.89348672, 0.092912  ],
            [0.13305163, 0.25584761, 0.33263241, ..., 0.04199925,
             0.58177805, 0.91114207],
            [0.09733777, 0.62870643, 0.36516336, ..., 0.76651482,
             0.93221001, 0.61671993],
            [0.70019899, 0.62076154, 0.83452246, ..., 0.1590405 ,
             0.10872037, 0.13184683]],

           ...,

           [[0.68119131, 0.70611556, 0.61505433, ..., 0.00625921,
             0.98375512, 0.99579594],
            [0.33047823, 0.61597769, 0.60912754, ..., 0.6115006 ,
             0.24288888, 0.63442191],
            [0.84127098, 0.32435406, 0.99521945, ..., 0.7427991 ,
             0.73597168, 0.36905316],
            [0.42356732, 0.59125756, 0.01766434, ..., 0.37699756,
             0.59866   , 0.81067259],
            [0.52233852, 0.99117263, 0.55755748, ..., 0.72073451,
             0.89713102, 0.87811069]],

           [[0.2898985 , 0.9866764 , 0.78767063, ..., 0.89041725,
             0.77742503, 0.96785833],
            [0.06624122, 0.69816162, 0.86054463, ..., 0.27168905,
             0.97001576, 0.76492886],
            [0.35354373, 0.6456928 , 0.31619671, ..., 0.8668176 ,
             0.50567786, 0.44217263],
            [0.07517909, 0.62285918, 0.5459408 , ..., 0.25945596,
             0.88213915, 0.31372372],
            [0.31609663, 0.66996938, 0.32992921, ..., 0.87817784,
             0.96468947, 0.23025046]],

           [[0.74410472, 0.93083177, 0.97429923, ..., 0.62150862,
             0.12208775, 0.12296714],
            [0.02005371, 0.57656288, 0.7102006 , ..., 0.11806982,
             0.70998149, 0.23672646],
            [0.99792816, 0.41025132, 0.66050125, ..., 0.06053665,
             0.58107898, 0.30374343],
            [0.9701459 , 0.69195133, 0.99861205, ..., 0.8658693 ,
             0.3898547 , 0.07674581],
            [0.53668254, 0.36373075, 0.61964071, ..., 0.74081211,
             0.86868786, 0.73018767]]])
    Coordinates:
      * epochs    (epochs) MultiIndex
      - dp        (epochs) float64 -0.3951 0.1433 0.398 ... -0.4318 -0.3211 -0.1029
      - blocks    (epochs) int64 0 0 0 0 0 1 1 1 1 1
      * channels  (channels) <U4 'ch_0' 'ch_1' 'ch_2' 'ch_3' 'ch_4'
      * times     (times) float64 0.0 0.001953 0.003906 ... 0.1895 0.1914 0.1934
    -------------------------------------------------------------------------------
    number of (subjects, roi, time points) : (5, 5, 100)
    minimum number of subject per roi: -inf
    modality : electrophysiological
    data grouped by : subject
    copnormed : False
    version : 0.3.3
    -------------------------------------------------------------------------------




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.316 seconds)


.. _sphx_glr_download_auto_examples_dataset_plot_dataset_xarray.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_dataset_xarray.py <plot_dataset_xarray.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_dataset_xarray.ipynb <plot_dataset_xarray.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
